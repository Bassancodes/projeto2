"use strict";(self.webpackChunkschedula_form=self.webpackChunkschedula_form||[]).push([[665],{665:function(e,n,t){t.r(n),t.d(n,{default:function(){return I}});var r=t(29439),o=t(45987),i=t(4942),a=t(1413),s=t(93433),c=t(74165),u=t(15861),d=t(72791),l=t(5936),f=t(34265),p=t(22501),h=t(43395),m=t(91330),y=t(29961),x=t(94515),v=t(79343),w=t(1025),b=t.n(w),g=t(25984),j=t(80184),k=["context","children","columns"],Z=d.lazy((function(){return t.e(2419).then(t.bind(t,42419))})),C=d.lazy((function(){return t.e(1286).then(t.bind(t,41286))})),D=d.lazy((function(){return t.e(503).then(t.bind(t,90503))})),S=d.lazy((function(){return t.e(3329).then(t.bind(t,53329))})),P=d.lazy((function(){return Promise.resolve().then(t.bind(t,29823))})),E=d.lazy((function(){return t.e(6445).then(t.bind(t,6445))})),O=d.lazy((function(){return t.e(5071).then(t.bind(t,49910))})),F=d.lazy((function(){return t.e(3517).then(t.bind(t,3517))})),N=d.lazy((function(){return t.e(7376).then(t.bind(t,89056))}));function z(e){if("string"!==typeof e)return e;var n=Number(e);return isNaN(n)?e:n}function M(e){var n=e.context,t=e.columns,r=e.setRowModesModel,o=e.setNewKey,y=n.props.schema.title;return(0,j.jsx)(d.Suspense,{children:(0,j.jsxs)(F,{spacing:1,children:[(0,j.jsx)(O,{variant:"button",display:"block",children:y},"title"),(0,j.jsxs)(f.D,{children:[(0,j.jsx)(p.S,{},1),(0,j.jsx)(h.L,{},2),(0,j.jsx)(m.Zh,{},3),n.props.readonly?"":(0,j.jsx)("div",{children:(0,j.jsxs)(N,{component:"label",color:"primary",startIcon:(0,j.jsx)(E,{}),children:["Import",(0,j.jsx)("input",{accept:["csv"],type:"file",hidden:!0,onChange:function(e){if(e.preventDefault(),e.target.files.length){var r=new FileReader;r.onload=function(){var e=(0,u.Z)((0,c.Z)().mark((function e(r){var o,i,a,s,u,d,l,f,p;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=r.target,i=b().parse(o.result,{header:!1}),a=null===i||void 0===i?void 0:i.data,u=t.map((function(e){return e.field})),d=t.map((function(e){return e.headerName})),a[0].every((function(e){return u.includes(e)}))?(s=a[0],a=a.slice(1)):a[0].every((function(e){return d.includes(e)}))?(s=a[0].map((function(e){return t.find((function(n){return n.headerName===e})).field})),a=a.slice(1)):s=t.map((function(e){return e.field})),p=n.props.schema.items.properties,n.props.onChange(a.map((function(e){return e.reduce((function(e,n,t){return l=s[t],"number"===(f=p[l].type)||"integer"===f?n=z(n):"boolean"===f&&(n="string"===typeof(n=z(n))?"false"!==n.toLowerCase():!!n),e[l]=n,e}),{})})));case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),r.readAsText(e.target.files[0]),e.target.value=null}}})]})},4),!n.props.readonly&&n.canAddItem(n.props.formData||[])?(0,j.jsx)(N,{color:"primary",startIcon:(0,j.jsx)(Z,{}),onClick:function(e){e&&e.preventDefault();var c={key:(0,g.x0)(),item:n._getNewFormDataRow()};o(c.key);var u=[].concat((0,s.Z)(n.state.keyedFormData),[c]);n.setState({keyedFormData:u,updatedKeyedFormData:!0},(function(){return n.props.onChange((e=u,Array.isArray(e)?e.map((function(e){return e.item})):[]));var e})),r((function(e){return(0,a.Z)((0,a.Z)({},e),{},(0,i.Z)({},c.key,{mode:l.se.Edit,fieldToFocus:t[0].field}))}))},children:"Add record"},5):"",n.props.readonly?"":(0,j.jsx)(N,{color:"primary",startIcon:(0,j.jsx)(D,{}),onClick:function(){n.props.onChange([])},children:"Delete all"},6)]},"toolbar")]})})}function I(e){var n=e.context,t=(e.children,e.columns),c=(0,o.Z)(e,k),u=d.useState({}),f=(0,r.Z)(u,2),p=f[0],h=f[1],m=d.useState(null),w=(0,r.Z)(m,2),b=w[0],g=w[1],Z=d.useState(c.pageSize||10),E=(0,r.Z)(Z,2),O=E[0],F=E[1],N=(n.state.keyedFormData||[]).map((function(e){var n=e.key,t=e.item;return Object.assign({},t,{id:n})})),z=function(e){return function(){h((0,a.Z)((0,a.Z)({},p),{},(0,i.Z)({},e,{mode:l.se.Edit})))}},I=function(e){return function(){g(null),h((0,a.Z)((0,a.Z)({},p),{},(0,i.Z)({},e,{mode:l.se.View})))}},A=function(e){return function(){var t=n.state.keyedFormData.findIndex((function(n){return n.key===e}));n.onDropIndexClick(t)()}},R=function(e){return function(){if(h((0,a.Z)((0,a.Z)({},p),{},(0,i.Z)({},e,{mode:l.se.View,ignoreModifications:!0}))),b===e){var t=n.state.keyedFormData.findIndex((function(n){return n.key===e}));n.onDropIndexClick(t)()}}},_=((n.props.schema||{}).items||{}).properties||{};if(t)t=(0,s.Z)(t);else{var K=new Set;Object.keys(_).forEach((function(e){K.add(e)})),N.forEach((function(e){Object.keys(e).forEach((function(e){K.add(e)}))})),K.delete("id"),t=Array.from(K).sort().map((function(e){return{field:e}}))}return t.forEach((function(e){if(e.renderEditCell=function(e){return function(e){var n=e.id,t=e.value,r=e.field,o=e.context,i=(0,y.l)(),a=o.props,s=a.registry,c=a.schema,u=s.fields.SchemaField,d=(c.items||{}).properties||{};return(0,j.jsx)("div",{style:{width:"100%"},children:(0,j.jsx)(u,{formData:t,schema:d[r]||{},onChange:function(e){i.current.setEditCellValue({id:n,field:r,value:e})},registry:s,idSchema:{$id:o.props.idSchema.$id+"-editing"}})})}((0,a.Z)({context:n},e))},!e.hasOwnProperty("headerName")){var t=_[e.field]||{};e.headerName=t.hasOwnProperty("title")?t.title:e.field}if(!e.hasOwnProperty("description")){var r=_[e.field]||{};r.hasOwnProperty("description")&&(e.description=r.description)}e.hasOwnProperty("flex")||e.hasOwnProperty("width")||(e.flex=1),e.hasOwnProperty("editable")||(e.editable=!n.props.readonly),e.hasOwnProperty("valueGetter")||"date"!==e.type||(e.valueGetter=function(e){var n=e.value;return n&&new Date(n)})})),n.props.readonly||t.push({field:"actions",type:"actions",width:100,getActions:function(e){var n,t=e.id;return(null===(n=p[t])||void 0===n?void 0:n.mode)===l.se.Edit?[(0,j.jsx)(x.u,{icon:(0,j.jsx)(S,{}),label:"Save",onClick:I(t)},"save"),(0,j.jsx)(x.u,{icon:(0,j.jsx)(P,{}),label:"Cancel",className:"textPrimary",onClick:R(t),color:"inherit"},"cancel")]:[(0,j.jsx)(x.u,{icon:(0,j.jsx)(C,{}),label:"Edit",className:"textPrimary",onClick:z(t),color:"inherit"},"edit"),(0,j.jsx)(x.u,{icon:(0,j.jsx)(D,{}),label:"Delete",onClick:A(t),color:"inherit"},"delete")]}}),c.isCellEditable=function(){return!n.props.readonly},(0,j.jsx)(d.Suspense,{children:(0,j.jsx)(v._,(0,a.Z)({autoHeight:!0,rows:N,columns:t,pageSize:O,disableSelectionOnClick:!0,onPageSizeChange:function(e){return F(e)},rowsPerPageOptions:[10,20,50,100],editMode:"row",rowModesModel:p,onRowModesModelChange:function(e){return h(e)},onRowEditStart:function(e,n){n.defaultMuiPrevented=!0},onRowEditStop:function(e,n){n.defaultMuiPrevented=!0},processRowUpdate:function(e){var t=(0,a.Z)((0,a.Z)({},e),{},{isNew:!1}),r=n.state.keyedFormData.findIndex((function(n){return n.key===e.id})),o=Object.assign({},e);return delete o.id,n.onChangeForIndex(r)(o),t},components:{Toolbar:M},componentsProps:{toolbar:{setRowModesModel:h,context:n,columns:t,setNewKey:g}},experimentalFeatures:{newEditingApi:!0},pagination:!0},c))})}}}]);
//# sourceMappingURL=665.9f26b1b7.chunk.js.map